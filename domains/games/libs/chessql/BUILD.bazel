load("//bazel/rules:java.bzl", "artifact", "java_library", "java_test_suite")

java_library(
    name = "ast",
    srcs = [
        "src/main/java/com/muchq/games/chessql/ast/AndExpr.java",
        "src/main/java/com/muchq/games/chessql/ast/ComparisonExpr.java",
        "src/main/java/com/muchq/games/chessql/ast/Expr.java",
        "src/main/java/com/muchq/games/chessql/ast/InExpr.java",
        "src/main/java/com/muchq/games/chessql/ast/MotifExpr.java",
        "src/main/java/com/muchq/games/chessql/ast/NotExpr.java",
        "src/main/java/com/muchq/games/chessql/ast/OrExpr.java",
        "src/main/java/com/muchq/games/chessql/ast/OrderByClause.java",
        "src/main/java/com/muchq/games/chessql/ast/SequenceExpr.java",
    ],
    visibility = ["//visibility:public"],
)

java_library(
    name = "compiler",
    srcs = [
        "src/main/java/com/muchq/games/chessql/compiler/CompiledQuery.java",
        "src/main/java/com/muchq/games/chessql/compiler/DataFusionSqlCompiler.java",
        "src/main/java/com/muchq/games/chessql/compiler/QueryCompiler.java",
        "src/main/java/com/muchq/games/chessql/compiler/SqlCompiler.java",
    ],
    visibility = ["//visibility:public"],
    deps = [
        ":ast",
        ":parser",
    ],
)

java_library(
    name = "lexer",
    srcs = [
        "src/main/java/com/muchq/games/chessql/lexer/Lexer.java",
        "src/main/java/com/muchq/games/chessql/lexer/Token.java",
        "src/main/java/com/muchq/games/chessql/lexer/TokenType.java",
    ],
    visibility = ["//visibility:public"],
)

java_library(
    name = "parser",
    srcs = [
        "src/main/java/com/muchq/games/chessql/parser/ParseException.java",
        "src/main/java/com/muchq/games/chessql/parser/ParsedQuery.java",
        "src/main/java/com/muchq/games/chessql/parser/Parser.java",
    ],
    visibility = ["//visibility:public"],
    deps = [
        ":ast",
        ":lexer",
    ],
)

java_test_suite(
    name = "compiler_test",
    size = "small",
    srcs = ["src/test/java/com/muchq/games/chessql/compiler/SqlCompilerTest.java"],
    deps = [
        ":ast",
        ":compiler",
        ":parser",
        artifact("junit:junit"),
        artifact("org.assertj:assertj-core"),
    ],
)

java_test_suite(
    name = "datafusion_compiler_test",
    size = "small",
    srcs = ["src/test/java/com/muchq/games/chessql/compiler/DataFusionSqlCompilerTest.java"],
    deps = [
        ":ast",
        ":compiler",
        ":parser",
        artifact("junit:junit"),
        artifact("org.assertj:assertj-core"),
    ],
)

java_test_suite(
    name = "lexer_test",
    size = "small",
    srcs = ["src/test/java/com/muchq/games/chessql/lexer/LexerTest.java"],
    deps = [
        ":lexer",
        artifact("junit:junit"),
        artifact("org.assertj:assertj-core"),
    ],
)

java_test_suite(
    name = "parser_test",
    size = "small",
    srcs = ["src/test/java/com/muchq/games/chessql/parser/ParserTest.java"],
    deps = [
        ":ast",
        ":parser",
        artifact("junit:junit"),
        artifact("org.assertj:assertj-core"),
    ],
)
