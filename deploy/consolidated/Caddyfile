api.muchq.com {
	@post_portrait {
		method POST
		path /portrait/v1/trace
	}

	@post_mithril {
		method POST
		path /mithril/v1/wordchain
	}

	@post_posterize_blur {
		method POST
		path /imagine/v1/blur
	}

	@post_posterize_edges {
		method POST
		path /imagine/v1/edges
	}

	@post_generate {
		method POST
		path /microgpt/v1/generate
	}

	@post_chat {
		method POST
		path /microgpt/v1/chat
	}

	@get_timeseries {
		method GET
		path /metrics/v1/timeseries/*
	}

	@get_metrics {
		method GET
		path /metrics/v1/scalar/*
	}

	@get_1d4_health {
		method GET
		path /1d4/v1/health
	}

	@post_1d4_index {
		method POST
		path /1d4/v1/index
	}

	@get_1d4_index {
		method GET
		path /1d4/v1/index/*
	}

	@post_1d4_query {
		method POST
		path /1d4/v1/query
	}

	@ws_thoughts {
		path /games/v1/thoughts-ws
	}

	@ws_golf {
		path /games/v1/golf-ws
	}

	@options {
		method OPTIONS
	}

	header {
		Access-Control-Allow-Origin "https://muchq.com"
		Access-Control-Allow-Methods "GET, POST, OPTIONS"
		Access-Control-Allow-Headers "Content-Type, Authorization"
		Access-Control-Max-Age "86400"
	}

	handle @options {
		header {
			Access-Control-Allow-Origin "https://muchq.com"
			Access-Control-Allow-Methods "GET, POST, OPTIONS"
			Access-Control-Allow-Headers "Content-Type, Authorization"
			Access-Control-Max-Age "86400"
		}
		respond 204
	}

	reverse_proxy @ws_thoughts games_ws_backend:8080
	reverse_proxy @ws_golf games_ws_backend:8080
	reverse_proxy @post_portrait portrait:8081
	reverse_proxy @get_timeseries prom_proxy:8082
	reverse_proxy @get_metrics prom_proxy:8082
	reverse_proxy @post_mithril mithril:8083
	reverse_proxy @post_posterize_blur posterize:8084
	reverse_proxy @post_posterize_edges posterize:8084
	reverse_proxy @post_generate microgpt-serve:8087
	reverse_proxy @post_chat microgpt-serve:8087

	handle @get_1d4_health {
		rewrite * /health
		reverse_proxy one_d4:8080
	}
	handle @post_1d4_index {
		rewrite * /v1/index
		reverse_proxy one_d4:8080
	}
	handle @get_1d4_index {
		uri strip_prefix /1d4
		reverse_proxy one_d4:8080
	}
	handle @post_1d4_query {
		rewrite * /v1/query
		reverse_proxy one_d4:8080
	}

	log {
		output file /var/log/caddy/access.log {
			roll_size 1gb
			roll_keep 5
			roll_keep_for 90d
		}
	}
}

www.r3dr.net {
	redir https://r3dr.net{uri}
}

r3dr.net {
	encode gzip
	@postshorten {
		method POST
		path /shorten
	}
	@getredir {
		method GET
		path /r/*
	}
	root * /var/www/r3dr
	reverse_proxy @postshorten r3dr:8080
	reverse_proxy @getredir r3dr:8080

	file_server
	log {
		output file /var/log/caddy/access.log {
			roll_size 1gb
			roll_keep 5
			roll_keep_for 90d
		}
	}
}

consolidated.cmptr.info {
	respond "Consolidating..."
}

git.muchq.com {
	reverse_proxy forgejo:3000

	log {
		output file /var/log/caddy/access.log {
			roll_size 1gb
			roll_keep 5
			roll_keep_for 90d
		}
	}
}

gpt.muchq.com {
	@post_generate {
		method POST
		path /microgpt/v1/generate
	}

	@post_chat {
		method POST
		path /microgpt/v1/chat
	}

	@options {
		method OPTIONS
	}

	header {
		Access-Control-Allow-Origin "https://tty1.uk"
		Access-Control-Allow-Methods "POST, OPTIONS"
		Access-Control-Allow-Headers "Content-Type"
		Access-Control-Max-Age "86400"
	}

	handle @options {
		header {
			Access-Control-Allow-Origin "https://tty1.uk"
			Access-Control-Allow-Methods "POST, OPTIONS"
			Access-Control-Allow-Headers "Content-Type"
			Access-Control-Max-Age "86400"
		}
		respond 204
	}

	reverse_proxy @post_generate microgpt-serve:8087
	reverse_proxy @post_chat microgpt-serve:8087

	log {
		output file /var/log/caddy/access.log {
			roll_size 1gb
			roll_keep 5
			roll_keep_for 90d
		}
	}
}

api.1d4.net {
	@post_index {
		method POST
		path /v1/index
	}

	@get_index {
		method GET
		path /v1/index /v1/index/*
	}

	@post_query {
		method POST
		path /v1/query
	}

	@get_health {
		method GET
		path /health
	}

	@options {
		method OPTIONS
	}

	header {
		Access-Control-Allow-Origin "https://1d4.net"
		Access-Control-Allow-Methods "GET, POST, OPTIONS"
		Access-Control-Allow-Headers "Content-Type, Authorization"
		Access-Control-Max-Age "86400"
	}

	handle @options {
		header {
			Access-Control-Allow-Origin "https://1d4.net"
			Access-Control-Allow-Methods "GET, POST, OPTIONS"
			Access-Control-Allow-Headers "Content-Type, Authorization"
			Access-Control-Max-Age "86400"
		}
		respond 204
	}

	handle @post_index {
		reverse_proxy one_d4:8080
	}

	handle @get_index {
		reverse_proxy one_d4:8080
	}

	handle @post_query {
		reverse_proxy one_d4:8080
	}

	handle @get_health {
		reverse_proxy one_d4:8080
	}

	handle {
		respond 404
	}

	log {
		output file /var/log/caddy/access.log {
			roll_size 1gb
			roll_keep 5
			roll_keep_for 90d
		}
	}
}

mcp.1d4.net {
	@mcp {
		method POST
		path /mcp
	}

	reverse_proxy @mcp mcpserver:8080

	log {
		output file /var/log/caddy/access.log {
			roll_size 1gb
			roll_keep 5
			roll_keep_for 90d
		}
	}
}
