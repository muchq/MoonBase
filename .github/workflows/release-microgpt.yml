name: Release microgpt

on:
  workflow_run:
    workflows: ["Test and Publish"]
    types:
      - completed
  push:
    tags:
      - 'microgpt-v*'

permissions:
  contents: write

concurrency:
  group: release-microgpt
  cancel-in-progress: false

jobs:
  release:
    uses: ./.github/workflows/release-rust-tool.yml
    with:
      tool_name: microgpt
      cargo_toml: domains/ai/apps/microgpt_cli/Cargo.toml
      bazel_target: "//domains/ai/apps/microgpt_cli:microgpt"
      binary_name: microgpt
      caller_event_name: ${{ github.event_name }}
      workflow_run_sha: ${{ github.event.workflow_run.head_sha || '' }}
      workflow_run_conclusion: ${{ github.event.workflow_run.conclusion || '' }}
    secrets: inherit
